{"ast":null,"code":"import _slicedToArray from\"/Users/sema/tagtag/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import MicRecorder from'mic-recorder-to-mp3';import blobUrlFromId from'./helpers/blobUrlFromId';import audiosUrl from'./helpers/audiosUrl';import Tags from\"./Tags\";// Instead of axios the audio notes are posted by XMLHttpRequest\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function AddAudioRec(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),title=_useState2[0],setTitle=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),tags=_useState4[0],setTags=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isRecording=_useState6[0],setIsRecording=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),blobURL=_useState8[0],setBlobUrl=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isBlocked=_useState10[0],setIsBlocked=_useState10[1];var _useState11=useState(new MicRecorder({bitRate:128})),_useState12=_slicedToArray(_useState11,2),Mp3Recorder=_useState12[0],setMp3Recorder=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),latestBlobID=_useState14[0],setLatestBlobID=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),blob=_useState16[0],setBlob=_useState16[1];useEffect(function(){var blobURLBackEnd=blobUrlFromId(latestBlobID);setBlobUrl(blobURLBackEnd);//the backend will change the file to stream from the database\n},[latestBlobID,blobURL]);var handleSubmit=function handleSubmit(event){event.preventDefault();blob!=null&&upload(blob);};var start=function start(){if(isBlocked){console.log('Permission Denied');}else{setBlob(null);Mp3Recorder.start().then(function(){setIsRecording(true);}).catch(function(e){return console.error(e);});}};// this will send the mp3 blob to the backend using:\n// https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n// https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects\nvar upload=function upload(){var xhr=new XMLHttpRequest();xhr.onload=function(e){// don't change to arrow arrow func\nif(this.readyState===4){var resp=JSON.parse(e.target.responseText);setLatestBlobID(resp._id);setTitle('');setTags([]);props.getAllAudios();}};var fd=new FormData();fd.append(\"data\",blob);fd.append(\"title\",title);fd.append(\"tags\",tags);xhr.open(\"POST\",audiosUrl(),true);var storedToken=localStorage.getItem('authToken');xhr.setRequestHeader('Authorization','Bearer '+storedToken);xhr.send(fd);};var stop=function stop(){Mp3Recorder.stop().getMp3().then(function(_ref){var _ref2=_slicedToArray(_ref,2),buffer=_ref2[0],blob=_ref2[1];setBlob(blob);setIsRecording(false);setIsBlocked(false);}).catch(function(e){return console.error(e);});};return/*#__PURE__*/_jsxs(\"div\",{className:\"Audios\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Save an audio\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Title\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:title,onChange:function onChange(event){return setTitle(event.target.value);}}),/*#__PURE__*/_jsx(\"h2\",{children:\"Record an audio\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:start,disabled:isRecording,children:\"Record\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:stop,disabled:!isRecording,children:\"Stop\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Tags\"}),/*#__PURE__*/_jsx(Tags,{tags:tags,setTags:setTags}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Save this audio \\u2795\"})]})]});}","map":{"version":3,"names":["useState","useEffect","MicRecorder","blobUrlFromId","audiosUrl","Tags","AddAudioRec","props","title","setTitle","tags","setTags","isRecording","setIsRecording","blobURL","setBlobUrl","isBlocked","setIsBlocked","bitRate","Mp3Recorder","setMp3Recorder","latestBlobID","setLatestBlobID","blob","setBlob","blobURLBackEnd","handleSubmit","event","preventDefault","upload","start","console","log","then","catch","e","error","xhr","XMLHttpRequest","onload","readyState","resp","JSON","parse","target","responseText","_id","getAllAudios","fd","FormData","append","open","storedToken","localStorage","getItem","setRequestHeader","send","stop","getMp3","buffer","value"],"sources":["/Users/sema/tagtag/client/src/components/AddAudioRec.js"],"sourcesContent":["import { useState, useEffect } from \"react\"\nimport MicRecorder from 'mic-recorder-to-mp3'\nimport blobUrlFromId from './helpers/blobUrlFromId'\nimport audiosUrl from './helpers/audiosUrl'\nimport Tags from \"./Tags\";\n\n// Instead of axios the audio notes are posted by XMLHttpRequest\n\nexport default function AddAudioRec(props) {\n\n    const [title, setTitle] = useState('')\n    const [tags, setTags] = useState([])\n    const [isRecording, setIsRecording] = useState(false);\n    const [blobURL, setBlobUrl] = useState('');\n    const [isBlocked, setIsBlocked] = useState(false);\n    const [Mp3Recorder, setMp3Recorder] = useState(new MicRecorder({ bitRate: 128 }));\n    const [latestBlobID, setLatestBlobID] = useState('')\n    const [blob, setBlob] = useState(null)\n\n\n    useEffect(() => {\n        const blobURLBackEnd = blobUrlFromId(latestBlobID);\n        setBlobUrl(blobURLBackEnd); //the backend will change the file to stream from the database\n    }, [latestBlobID, blobURL])\n\n    const handleSubmit = event => {\n        event.preventDefault();\n        (blob != null) && upload(blob); \n    }\n\n    let start = () => {\n        if (isBlocked) {\n            console.log('Permission Denied');\n        } else {\n            setBlob(null)\n            Mp3Recorder\n                .start()\n                .then(() => {\n                    setIsRecording(true);\n                }).catch((e) => console.error(e));\n        }\n    };\n\n    // this will send the mp3 blob to the backend using:\n    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n    // https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects\n    let upload = () => {\n        var xhr = new XMLHttpRequest();\n\n        xhr.onload = function (e) { // don't change to arrow arrow func\n            if (this.readyState === 4) {\n                const resp = JSON.parse(e.target.responseText)\n                setLatestBlobID(resp._id);\n\n                setTitle('');\n                setTags([]);\n                props.getAllAudios();\n            }\n        }\n\n        var fd = new FormData();\n        fd.append(\"data\", blob);\n        fd.append(\"title\", title);\n        fd.append(\"tags\", tags);\n\n        xhr.open(\"POST\", audiosUrl(), true);\n        const storedToken = localStorage.getItem('authToken')\n        xhr.setRequestHeader('Authorization', 'Bearer ' + storedToken);\n        xhr.send(fd);\n\n    }\n\n\n    let stop = () => {\n        Mp3Recorder\n            .stop()\n            .getMp3()\n            .then(([buffer, blob]) => {\n                setBlob(blob);\n                setIsRecording(false);\n                setIsBlocked(false);\n            }).catch((e) => console.error(e));\n    }\n\n    return (\n        <div className=\"Audios\">\n            <h1>Save an audio</h1>\n            <form onSubmit={handleSubmit}>\n                <h2>Title</h2>\n                <input\n                    type=\"text\"\n                    value={title}\n                    onChange={event => setTitle(event.target.value)}\n                />\n\n                <h2>Record an audio</h2>\n                <button type=\"button\" onClick={start} disabled={isRecording}>Record</button>\n                <button type=\"button\" onClick={stop} disabled={!isRecording}>Stop</button>\n                {/* <button type=\"button\" onClick={cancel} disabled={blob === null && !isRecording}>Cancel</button> */}\n\n                <h2>Tags</h2>\n                <Tags\n                    tags={tags}\n                    setTags={setTags}\n                />\n\n                <button type=\"submit\">Save this audio âž•</button>\n            </form>\n\n        </div>\n    )\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}