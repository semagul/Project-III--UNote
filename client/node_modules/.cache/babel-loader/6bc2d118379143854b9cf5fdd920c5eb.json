{"ast":null,"code":"var _jsxFileName = \"/Users/sema/UNote/client/src/components/AddAudioRec.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport MicRecorder from 'mic-recorder-to-mp3';\nimport blobUrlFromId from './helpers/blobUrlFromId';\nimport audiosUrl from './helpers/audiosUrl';\nimport Tags from \"./Tags\"; // Instead of axios the audio notes are posted by XMLHttpRequest\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function AddAudioRec(props) {\n  _s();\n\n  const [title, setTitle] = useState('');\n  const [tags, setTags] = useState([]);\n  const [isRecording, setIsRecording] = useState(false);\n  const [blobURL, setBlobUrl] = useState('');\n  const [isBlocked, setIsBlocked] = useState(false);\n  const [Mp3Recorder, setMp3Recorder] = useState(new MicRecorder({\n    bitRate: 128\n  }));\n  const [latestBlobID, setLatestBlobID] = useState('');\n  const [blob, setBlob] = useState(null);\n  useEffect(() => {\n    const blobURLBackEnd = blobUrlFromId(latestBlobID);\n    setBlobUrl(blobURLBackEnd); //the backend will change the file to stream from the database\n  }, [latestBlobID, blobURL]);\n\n  const handleSubmit = event => {\n    console.log(\"YOU ARE HERE\");\n    event.preventDefault();\n    upload(blob);\n  };\n\n  let start = () => {\n    if (isBlocked) {\n      console.log('Permission Denied');\n    } else {\n      Mp3Recorder.start().then(() => {\n        setIsRecording(true);\n      }).catch(e => console.error(e));\n    }\n  }; // this will send the mp3 blob to the backend using:\n  // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n  // https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects\n\n\n  let upload = () => {\n    var xhr = new XMLHttpRequest();\n\n    xhr.onload = function (e) {\n      // don't change to arrow arrow func\n      if (this.readyState === 4) {\n        const resp = JSON.parse(e.target.responseText);\n        setLatestBlobID(resp._id);\n        setTitle('');\n        setTags([]);\n        props.getAllAudios();\n      }\n    };\n\n    var fd = new FormData();\n    fd.append(\"data\", blob);\n    fd.append(\"title\", title);\n    fd.append(\"tags\", tags);\n    xhr.open(\"POST\", audiosUrl(), true);\n    const storedToken = localStorage.getItem('authToken');\n    xhr.setRequestHeader('Authorization', 'Bearer ' + storedToken);\n    xhr.send(fd);\n  };\n\n  let stop = shouldPostNote => {\n    Mp3Recorder.stop().getMp3().then(_ref => {\n      let [buffer, blob] = _ref;\n\n      if (shouldPostNote) {\n        setBlob(blob);\n      } else {\n        console.log(\"Discarding note\");\n      }\n\n      setIsRecording(false);\n      setIsBlocked(false);\n    }).catch(e => console.error(e));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Audios\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Save an audio\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Title\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: title,\n        onChange: event => setTitle(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Record an audio\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: start,\n        disabled: isRecording,\n        children: \"Record\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => stop(true),\n        disabled: !isRecording,\n        children: \"Stop\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => stop(false),\n        disabled: !isRecording,\n        children: \"Cancel\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Tags\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Tags, {\n        tags: tags,\n        setTags: setTags\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        type: \"\",\n        children: \"Save this audio \\u2795\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 9\n  }, this);\n}\n\n_s(AddAudioRec, \"cnVdcNJEjEd+jmWCSO+Y6Fodmwc=\");\n\n_c = AddAudioRec;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddAudioRec\");","map":{"version":3,"names":["useState","useEffect","MicRecorder","blobUrlFromId","audiosUrl","Tags","AddAudioRec","props","title","setTitle","tags","setTags","isRecording","setIsRecording","blobURL","setBlobUrl","isBlocked","setIsBlocked","Mp3Recorder","setMp3Recorder","bitRate","latestBlobID","setLatestBlobID","blob","setBlob","blobURLBackEnd","handleSubmit","event","console","log","preventDefault","upload","start","then","catch","e","error","xhr","XMLHttpRequest","onload","readyState","resp","JSON","parse","target","responseText","_id","getAllAudios","fd","FormData","append","open","storedToken","localStorage","getItem","setRequestHeader","send","stop","shouldPostNote","getMp3","buffer","value"],"sources":["/Users/sema/UNote/client/src/components/AddAudioRec.js"],"sourcesContent":["import { useState, useEffect } from \"react\"\nimport MicRecorder from 'mic-recorder-to-mp3'\nimport blobUrlFromId from './helpers/blobUrlFromId'\nimport audiosUrl from './helpers/audiosUrl'\nimport Tags from \"./Tags\";\n\n// Instead of axios the audio notes are posted by XMLHttpRequest\n\nexport default function AddAudioRec(props) {\n\n    const [title, setTitle] = useState('')\n    const [tags, setTags] = useState([])\n    const [isRecording, setIsRecording] = useState(false);\n    const [blobURL, setBlobUrl] = useState('');\n    const [isBlocked, setIsBlocked] = useState(false);\n    const [Mp3Recorder, setMp3Recorder] = useState(new MicRecorder({ bitRate: 128 }));\n    const [latestBlobID, setLatestBlobID] = useState('')\n    const [blob, setBlob] = useState(null)\n\n\n    useEffect(() => {\n        const blobURLBackEnd = blobUrlFromId(latestBlobID);\n        setBlobUrl(blobURLBackEnd); //the backend will change the file to stream from the database\n    }, [latestBlobID, blobURL])\n\n    const handleSubmit = event => {\n        console.log(\"YOU ARE HERE\")\n        event.preventDefault()\n        upload(blob)\n    }\n\n    let start = () => {\n        if (isBlocked) {\n            console.log('Permission Denied');\n        } else {\n            Mp3Recorder\n                .start()\n                .then(() => {\n                    setIsRecording(true);\n                }).catch((e) => console.error(e));\n        }\n    };\n\n    // this will send the mp3 blob to the backend using:\n    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n    // https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects\n    let upload = () => {\n        var xhr = new XMLHttpRequest();\n\n        xhr.onload = function (e) { // don't change to arrow arrow func\n            if (this.readyState === 4) {\n                const resp = JSON.parse(e.target.responseText)\n                setLatestBlobID(resp._id);\n\n                setTitle('');\n                setTags([]);\n                props.getAllAudios();\n            }\n        }\n\n        var fd = new FormData();\n        fd.append(\"data\", blob);\n        fd.append(\"title\", title);\n        fd.append(\"tags\", tags);\n\n        xhr.open(\"POST\", audiosUrl(), true);\n        const storedToken = localStorage.getItem('authToken')\n        xhr.setRequestHeader('Authorization', 'Bearer ' + storedToken);\n        xhr.send(fd);\n    }\n\n    let stop = (shouldPostNote) => {\n        Mp3Recorder\n            .stop()\n            .getMp3()\n            .then(([buffer, blob]) => {\n                if (shouldPostNote) {\n                    setBlob(blob);\n                } else {\n                    console.log(\"Discarding note\")\n                }\n                setIsRecording(false);\n                setIsBlocked(false);\n            }).catch((e) => console.error(e));\n    }\n\n    return (\n        <div className=\"Audios\">\n            <h1>Save an audio</h1>\n            <form onSubmit={handleSubmit}>\n                <h2>Title</h2>\n                <input\n                    type=\"text\"\n                    value={title}\n                    onChange={event => setTitle(event.target.value)}\n                />\n\n                <h2>Record an audio</h2>\n                <button onClick={start} disabled={isRecording}>Record</button>\n                <button onClick={() => stop(true)} disabled={!isRecording}>Stop</button>\n                <button onClick={() => stop(false)} disabled={!isRecording}>Cancel</button>\n\n                <h2>Tags</h2>\n                <Tags\n                    tags={tags}\n                    setTags={setTags}\n                />\n\n                <button type=\"submit\" type=''>Save this audio ➕</button>\n            </form>\n\n        </div>\n    )\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}